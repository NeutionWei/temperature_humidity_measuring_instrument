C51 COMPILER V9.52.0.0   KEY                                                               04/23/2019 16:49:35 PAGE 1   


C51 COMPILER V9.52.0.0, COMPILATION OF MODULE KEY
OBJECT MODULE PLACED IN .\output\key.obj
COMPILER INVOKED BY: D:\Keil_v4\C51\BIN\C51.EXE source\key.c BROWSE INCDIR(.\include) DEBUG OBJECTEXTEND PRINT(.\key.lst
                    -) TABS(2) OBJECT(.\output\key.obj)

line level    source

   1          #include "key.h"
   2          #include <reg52.h>
   3          
   4          /*
   5          sbit key8 = P1^7;
   6          sbit key1 = P1^0;
   7          sbit p00 = P0^0;
   8          sbit p01 = P0^1;
   9          sbit p06 = P0^6;
  10          
  11          
  12          void key_test()
  13          {
  14            key8 = 0;
  15            if(key1 == 0)
  16            {
  17              Delayms(20);
  18              if(key1 == 0)
  19              {
  20                if(++Flag_key_menu >= MENU_ADJ_NUM)
  21                  Flag_key_menu = 0;
  22              }
  23              while(!key1);
  24            }
  25            
  26          }*/
  27          
  28          
  29          
  30          volatile unsigned char Flag_key_incre;
  31          volatile unsigned char Flag_key_decre;
  32          volatile unsigned char Flag_key_menu;
  33          
  34          sbit GND = P1^7;
  35          sbit PORT_K_MENU = P1^0;
  36          sbit LED1 = P0^1;
  37          
  38          void Keys_Scan()
  39          {
  40   1        static unsigned int key_state = 0;
  41   1        unsigned char key_press;
  42   1        unsigned char key_input;
  43   1        //u8 key_return = 0;  
  44   1        GND = 0;      
  45   1        key_input  = !PORT_K_MENU;
  46   1        key_input  = key_input<<2;
  47   1        //key_input |= (!PORT_K_D);
  48   1        key_press  = key_input;         // 读按键I/O电平
  49   1        switch (key_state)
  50   1        {
  51   2          case key_state_0:         // 按键初始态
  52   2            //if (key_press) key_state = key_state_1; // 键被按下，状态转换到键确认态
  53   2            if (key_press)
  54   2            {
C51 COMPILER V9.52.0.0   KEY                                                               04/23/2019 16:49:35 PAGE 2   

  55   3              key_state = key_state_1;
  56   3              //ON_LED_R();
  57   3            }
  58   2            break;
  59   2            
  60   2          case key_state_1:         // 按键确认态
  61   2            if (key_press)
  62   2            {
  63   3              if(key_press & KEY_INCRE)
  64   3              {
  65   4                  //Flag_key_incre = 1;
  66   4              }
  67   3              else if(key_press & KEY_DECRE)
  68   3              {
  69   4                  //Flag_key_decre = 1;
  70   4              }
  71   3              else if(key_press & KEY_MENU)
  72   3              {
  73   4                // 每按一次，光标时间向后挪，直到最后才正常显示时间
  74   4                //Flag_key_menu = 1;
  75   4                //LED1 = ~LED1;
  76   4                //Flag_key_menu = !Flag_key_menu;
  77   4                if(++Flag_key_menu >= MENU_ADJ_NUM)
  78   4                  Flag_key_menu = MENU_NoADJ;
  79   4              }
  80   3              key_state = key_state_2;
  81   3            }
  82   2            else
  83   2              key_state = key_state_0;  // 按键已抬起，转换到按键初始态
  84   2            break;
  85   2          case key_state_2:
  86   2            if (!key_press)
  87   2            {
  88   3              key_state = key_state_0;  // 按键已释放，转换到按键初始态
  89   3            }
  90   2            break;
  91   2      /*    case key_state_3:
  92   2            if (!key_press)
  93   2              key_state = key_state_0; //按键已释放，转换到按键初始态
  94   2            
  95   2            break;*/
  96   2          default:break;
  97   2        } 
  98   1        //return key_return;
  99   1      }
 100          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =     88    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      5    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
