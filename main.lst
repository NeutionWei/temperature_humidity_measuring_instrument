C51 COMPILER V9.52.0.0   MAIN                                                              05/07/2019 12:46:33 PAGE 1   


C51 COMPILER V9.52.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\output\main.obj
COMPILER INVOKED BY: D:\Keil_v4\C51\BIN\C51.EXE source\main.c BROWSE INCDIR(.\include) DEBUG OBJECTEXTEND PRINT(.\main.l
                    -st) TABS(2) OBJECT(.\output\main.obj)

line level    source

   1          /**************************************************************************************
   2          *                 基于单片机的温湿度与时钟显示                        *
   3          实现现象：
   4          注意事项：                                          
   5          ***************************************************************************************/
   6          
   7          #include "reg52.h"       //此文件中定义了单片机的一些特殊功能寄存器
   8          #include "intrins.h"
   9          #include "display.h"
  10          #include "ds1302.h"
  11          //#include "bmp.h"
  12          #include "oled.h"
  13          #include "key.h"
  14          #include "detect.h"
  15          
  16          
  17          volatile unsigned char Cnt_MainLoop;
  18          volatile unsigned char Flag_MainLoop;
  19          
  20          sbit GND_P00 = P0^0;
  21          //unsigned char flag_300ms;
  22          
  23          /*******************************************************************************
  24          * 函 数 名       : Init_Time0
  25          * 函数功能       : 定时器0初始化程序
  26          * 输    入       : 无
  27          * 输    出       : 无
  28          *******************************************************************************/
  29          
  30          void Timer0_Init()
  31          {
  32   1        TMOD |= 0x01;            // 设为工作方式1
  33   1        TH0 = (65536 - 10000)/256;
  34   1        TL0 = (65536 - 10000)%256; // 10ms溢出
  35   1        TR0 = 1;                 // 开定时器0
  36   1        ET0 = 1;                 // 使能定时器0中断
  37   1        EA  = 1;                 // 使能全局中断
  38   1      }
  39          
  40          
  41          
  42          /*******************************************************************************
  43          * 函 数 名       : Init_Time1
  44          * 函数功能       : 定时器1初始化程序
  45          * 输    入       : 无
  46          * 输    出       : 无
  47          *******************************************************************************/
  48          
  49          void Timer1_Init()
  50          {
  51   1        TMOD |= 0x10;                   // 设为工作方式1
  52   1        TH1 = ((65536 - 10000) >> 8);   // 赋值高8位
  53   1        TL1 = ((65536 - 10000) & 0xff); // 赋值低8位，50000us溢出
  54   1        TR0 = 1;                        // 开定时器1
C51 COMPILER V9.52.0.0   MAIN                                                              05/07/2019 12:46:33 PAGE 2   

  55   1        EA  = 1;
  56   1        /*TMOD |= 0x20;                   // 设为工作方式2
  57   1        TH0 = TL0 = 0;                  // 256us溢出
  58   1        TR0 = 1;                        // 开定时器1*/
  59   1      }
  60          
  61          
  62          
  63          
  64          void Timer1_usDelay(int us)
  65          {
  66   1      /*#define   Timer1_CNTR   ((TH0 << 8) | TL0)
  67   1        
  68   1        unsigned int cnt = us;          // 1us对应1个计数值
  69   1        unsigned int pre = Timer1_CNTR; // 获得当前计数值
  70   1        unsigned int cur;
  71   1        unsigned int delta;
  72   1        
  73   1        while(cnt > 0)
  74   1        {
  75   1          cur = Timer1_CNTR;  // 获得最新计数值
  76   1          if(cur >= pre)
  77   1            delta = cur - pre;
  78   1          else
  79   1            delta = cur + (50000 - pre);
  80   1          cnt = cnt - delta;
  81   1          pre = cur;
  82   1        }*/
  83   1        
  84   1        int cnt = us;           // 1us对应1个计数值
  85   1        int pre = TL0;          // 获得当前计数值
  86   1        int cur;
  87   1        int delta;
  88   1        
  89   1        while(cnt > 0)
  90   1        {
  91   2          cur = TL0;            // 获得最新计数值
  92   2          if(cur >= pre)
  93   2            delta = cur - pre;
  94   2          else
  95   2            delta = cur + (256 - pre);
  96   2          cnt = cnt - delta;
  97   2          pre = cur;
  98   2          
  99   2        } 
 100   1      }
 101          
 102          
 103          
 104          
 105          /*void Timer1_msDelay(int ms)
 106          {
 107            int cnt = ms;
 108            
 109            while(cnt >= 0)
 110            {
 111              Timer1_usDelay(1000);
 112              cnt--;
 113            }
 114          }
 115          
 116          void Timer1_sDelay(int s)
C51 COMPILER V9.52.0.0   MAIN                                                              05/07/2019 12:46:33 PAGE 3   

 117          {
 118            int cnt = s;
 119            
 120            while(cnt >= 0)
 121            {
 122              Timer1_msDelay(1000);
 123              cnt--;
 124            }
 125          }*/
 126          
 127          void Delay(volatile unsigned char x)
 128          {
 129   1        unsigned char i = 0;
 130   1        
 131   1        while(x--)
 132   1        {
 133   2          while(--i)
 134   2          {
 135   3            _nop_();
 136   3            _nop_();
 137   3            _nop_();
 138   3            _nop_();
 139   3            //asm("nop");
 140   3            //asm("nop");
 141   3            //asm("nop");
 142   3            //asm("nop");
 143   3          }
 144   2        }
 145   1      }
 146          
 147          //******************************软件延时函数************************* 
 148          void Delayms(unsigned int ms) 
 149          {    
 150   1        unsigned int  i;      
 151   1        do    
 152   1         {        
 153   2           for(i=700;i;i--);                 //以1ms为延时单位   
 154   2         } while(--ms);   
 155   1      } 
 156          
 157          
 158          
 159          /*******************************************************************************
 160          * 函 数 名       : main
 161          * 函数功能       : 主函数
 162          * 输    入       : 无
 163          * 输    出       : 无
 164          *******************************************************************************/
 165          
 166          void main()
 167          { 
 168   1      //  p00 = 0;
 169   1      //  p06 = 0;
 170   1      //  p01 = 1;
 171   1        GND_P00 = 0;
 172   1        //Timer0_Init();  // 定时器0初始化
 173   1        //Timer1_Init();  // 定时器1初始化
 174   1        Disp_Init();    // 显示模块初始化
 175   1        //DS1302_Init();
 176   1        Delay(200);
 177   1        while(1)
 178   1        {
C51 COMPILER V9.52.0.0   MAIN                                                              05/07/2019 12:46:33 PAGE 4   

 179   2          //p08 = 0;
 180   2          //Timer1_sDelay(1);
 181   2          //p08 = 1;
 182   2          //Timer1_sDelay(1);
 183   2          //p08 = 0;
 184   2          //if(Flag_MainLoop == 1)
 185   2          {
 186   3            //Flag_MainLoop = 0;
 187   3            //OLED_Clear();
 188   3      //      key_test();
 189   3            Disp_Data();  // 显示温湿度数据
 190   3            //DHT11_receive();
 191   3            Keys_Scan();  // 按键扫描
 192   3            DS1302_Get(); // 获得时钟数据
 193   3            DHT11_Get();  // 获得温湿度数据
 194   3            Dete_Data();  // 数据处理
 195   3          }
 196   2        }
 197   1      }
 198          
 199          
 200          
 201          /*******************************************************************************
 202          * 函 数 名       : Time1_Int
 203          * 函数功能       : 定时器0中断服务程序
 204          * 输    入       : 无
 205          * 输    出       : 无
 206          *******************************************************************************/
 207          
 208          void Timer1_Int() interrupt 3
 209          { 
 210   1        //static unsigned char Cnt_Timer0;
 211   1        
 212   1      
 213   1        TH0 = (65536 - 10000)/256;
 214   1        TL0 = (65536 - 10000)%256; // 10ms溢出
 215   1        
 216   1        //if()
 217   1        //Flag_MainLoop = 1;
 218   1        /*if(++Cnt_Timer0 >= 8) // 8*125us = 1ms
 219   1        {
 220   1          //Cnt_Timer0 = 0;
 221   1          if(++Cnt_MainLoop >= 10) // 10*10ms = 100ms
 222   1          {
 223   1            Cnt_MainLoop  = 0;
 224   1            Flag_MainLoop = 1;
 225   1          }
 226   1        } */ 
 227   1      }
 228          
 229          
 230          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    186    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      2       3
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
C51 COMPILER V9.52.0.0   MAIN                                                              05/07/2019 12:46:33 PAGE 5   

END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
