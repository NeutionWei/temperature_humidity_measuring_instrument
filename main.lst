C51 COMPILER V9.52.0.0   MAIN                                                              04/22/2019 15:27:59 PAGE 1   


C51 COMPILER V9.52.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\output\main.obj
COMPILER INVOKED BY: D:\Keil_v4\C51\BIN\C51.EXE source\main.c BROWSE INCDIR(.\include) DEBUG OBJECTEXTEND PRINT(.\main.l
                    -st) TABS(2) OBJECT(.\output\main.obj)

line level    source

   1          /**************************************************************************************
   2          *                 基于单片机的温湿度与时钟显示                        *
   3          实现现象：
   4          注意事项：                                          
   5          ***************************************************************************************/
   6          
   7          #include "reg52.h"       //此文件中定义了单片机的一些特殊功能寄存器
   8          #include "intrins.h"
   9          #include "display.h"
  10          #include "ds1302.h"
  11          //#include "bmp.h"
  12          #include "oled.h"
  13          #include "key.h"
  14          #include "detect.h"
  15          
  16          sbit p00 = P0^0;
  17          sbit p01 = P0^1;
  18          sbit p06 = P0^6;
  19          
  20          volatile unsigned char Cnt_MainLoop;
  21          volatile unsigned char Flag_MainLoop;
  22          
  23          //unsigned char flag_300ms;
  24          
  25          /*******************************************************************************
  26          * 函 数 名       : Init_Time0
  27          * 函数功能       : 定时器0初始化程序
  28          * 输    入       : 无
  29          * 输    出       : 无
  30          *******************************************************************************/
  31          
  32          void Timer0_Init()
  33          {
  34   1        TMOD |= 0x01;            // 设为工作方式1
  35   1        TH0 = (65536 - 10000)/256;
  36   1        TL0 = (65536 - 10000)%256; // 10ms溢出
  37   1        TR0 = 1;                 // 开定时器0
  38   1        ET0 = 1;                 // 使能定时器0中断
  39   1        EA  = 1;                 // 使能全局中断
  40   1      }
  41          
  42          
  43          
  44          /*******************************************************************************
  45          * 函 数 名       : Init_Time1
  46          * 函数功能       : 定时器1初始化程序
  47          * 输    入       : 无
  48          * 输    出       : 无
  49          *******************************************************************************/
  50          
  51          void Timer1_Init()
  52          {
  53   1        /*TMOD |= 0x10;                   // 设为工作方式1
  54   1        TH1 = ((65536 - 50000) >> 8);   // 赋值高8位
C51 COMPILER V9.52.0.0   MAIN                                                              04/22/2019 15:27:59 PAGE 2   

  55   1        TL1 = ((65536 - 50000) & 0xff); // 赋值低8位，50000us溢出
  56   1        TR0 = 1;                        // 开定时器1*/
  57   1        
  58   1        TMOD |= 0x20;                   // 设为工作方式2
  59   1        TH0 = TL0 = 0;                  // 256us溢出
  60   1        TR0 = 1;                        // 开定时器1
  61   1      }
  62          
  63          
  64          
  65          
  66          void Timer1_usDelay(int us)
  67          {
  68   1      /*#define   Timer1_CNTR   ((TH0 << 8) | TL0)
  69   1        
  70   1        unsigned int cnt = us;          // 1us对应1个计数值
  71   1        unsigned int pre = Timer1_CNTR; // 获得当前计数值
  72   1        unsigned int cur;
  73   1        unsigned int delta;
  74   1        
  75   1        while(cnt > 0)
  76   1        {
  77   1          cur = Timer1_CNTR;  // 获得最新计数值
  78   1          if(cur >= pre)
  79   1            delta = cur - pre;
  80   1          else
  81   1            delta = cur + (50000 - pre);
  82   1          cnt = cnt - delta;
  83   1          pre = cur;
  84   1        }*/
  85   1        
  86   1        int cnt = us;           // 1us对应1个计数值
  87   1        int pre = TL0;          // 获得当前计数值
  88   1        int cur;
  89   1        int delta;
  90   1        
  91   1        while(cnt > 0)
  92   1        {
  93   2          cur = TL0;            // 获得最新计数值
  94   2          if(cur >= pre)
  95   2            delta = cur - pre;
  96   2          else
  97   2            delta = cur + (256 - pre);
  98   2          cnt = cnt - delta;
  99   2          pre = cur;
 100   2          
 101   2        } 
 102   1      }
 103          
 104          
 105          
 106          
 107          /*void Timer1_msDelay(int ms)
 108          {
 109            int cnt = ms;
 110            
 111            while(cnt >= 0)
 112            {
 113              Timer1_usDelay(1000);
 114              cnt--;
 115            }
 116          }
C51 COMPILER V9.52.0.0   MAIN                                                              04/22/2019 15:27:59 PAGE 3   

 117          
 118          void Timer1_sDelay(int s)
 119          {
 120            int cnt = s;
 121            
 122            while(cnt >= 0)
 123            {
 124              Timer1_msDelay(1000);
 125              cnt--;
 126            }
 127          }*/
 128          
 129          void Delay(volatile unsigned char x)
 130          {
 131   1        unsigned char i = 0;
 132   1        
 133   1        while(x--)
 134   1        {
 135   2          while(--i)
 136   2          {
 137   3            _nop_();
 138   3            _nop_();
 139   3            _nop_();
 140   3            _nop_();
 141   3            //asm("nop");
 142   3            //asm("nop");
 143   3            //asm("nop");
 144   3            //asm("nop");
 145   3          }
 146   2        }
 147   1      }
 148          
 149          
 150          /*******************************************************************************
 151          * 函 数 名       : main
 152          * 函数功能       : 主函数
 153          * 输    入       : 无
 154          * 输    出       : 无
 155          *******************************************************************************/
 156          
 157          void main()
 158          { 
 159   1        p00 = 0;
 160   1        p06 = 0;
 161   1        //Timer0_Init();  // 定时器0初始化
 162   1        //Timer1_Init();  // 定时器1初始化
 163   1        Disp_Init();    // 显示模块初始化
 164   1        //DS1302_Init();
 165   1        Delay(200);
 166   1        while(1)
 167   1        {
 168   2          //p08 = 0;
 169   2          //Timer1_sDelay(1);
 170   2          //p08 = 1;
 171   2          //Timer1_sDelay(1);
 172   2          //p08 = 0;
 173   2          //if(Flag_MainLoop == 1)
 174   2          {
 175   3            //Flag_MainLoop = 0;
 176   3            //OLED_Clear();
 177   3            Disp_Data();  // 显示温湿度数据
 178   3            //DHT11_receive();
C51 COMPILER V9.52.0.0   MAIN                                                              04/22/2019 15:27:59 PAGE 4   

 179   3            //Keys_Scan();  // 按键扫描
 180   3            DS1302_Get(); // 获得时钟数据
 181   3            DHT11_Get();  // 获得温湿度数据
 182   3            Dete_Data();  // 数据处理
 183   3          }
 184   2        }
 185   1      }
 186          
 187          
 188          
 189          /*******************************************************************************
 190          * 函 数 名       : Time0_Int
 191          * 函数功能       : 定时器0中断服务程序
 192          * 输    入       : 无
 193          * 输    出       : 无
 194          *******************************************************************************/
 195          
 196          void Timer0_Int() interrupt 1
 197          { 
 198   1        //static unsigned char Cnt_Timer0;
 199   1        
 200   1      
 201   1        TH0 = (65536 - 10000)/256;
 202   1        TL0 = (65536 - 10000)%256; // 10ms溢出
 203   1      
 204   1        //if(++Cnt_Timer0 >= 8) // 8*125us = 1ms
 205   1        {
 206   2          //Cnt_Timer0 = 0;
 207   2          if(++Cnt_MainLoop >= 10) // 10*10ms = 100ms
 208   2          {
 209   3            Cnt_MainLoop  = 0;
 210   3            Flag_MainLoop = 1;
 211   3          }
 212   2        }  
 213   1      }
 214          
 215          
 216          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    190    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      2       3
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
